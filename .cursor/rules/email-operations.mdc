---
description: Specifies email operations including atomic moves, folder sync, search, and session management
globs: ["src/imap/**/*.rs", "src/api/**/*.rs"]
alwaysApply: false
---


# email-operations

### Core Email Operations

The email operations logic is centered around the IMAP session management and atomic operations in `src/imap/session.rs`:

1. **Atomic Move Operations**
- Implements atomic email moves between folders using transactional semantics
- Validates source and destination folders before initiating moves 
- Maintains message states during transfer
- Handles partial failures with rollback capabilities

2. **Folder Synchronization**
- Implements optimistic locking for folder modifications
- Tracks folder modification sequences
- Validates folder states before operations
- Detects and resolves folder conflicts

3. **Search Implementation**
- Provides search criteria parsing and validation
- Supports complex search filters including:
  - Subject/body text search
  - Flag-based filtering
  - Date range queries
  - Header field searches
- Maps search results to domain objects

4. **Session State Management**
- Maintains IMAP session state 
- Tracks selected folders
- Manages connection lifecycle
- Handles session recovery

5. **Email Flag Operations**
- Atomic flag updates
- Bulk flag modifications
- Flag state validation
- Flag synchronization across sessions

6. **Email Movement**
- Validates source/destination folders
- Preserves message attributes during moves
- Handles quota restrictions
- Maintains folder consistency

Relevant Files:
```
src/imap/session.rs
src/imap/client.rs
src/imap/types.rs
src/api/rest.rs
```

$END$
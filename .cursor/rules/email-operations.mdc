# email-operations

### Email Movement Operations
- MUST: Implement atomic email moves using `async_imap::Session::mv` with fallback to copy+delete
- AVOID: Direct deletion without verifying successful copy
- WHY: Ensures data integrity during folder transfers
- EXAMPLE: `src/imap/session.rs:move_email()`

### Folder Synchronization
- MUST: Check folder status before email operations using `select_folder()`
- AVOID: Caching folder state or assuming folder exists
- WHY: Prevents race conditions and lost updates
- EXAMPLE: `src/imap/session.rs:select_folder()`

### Email Search Implementation 
- MUST: Transform search criteria to IMAP format using `format_search_criteria()`
- AVOID: Client-side filtering of search results
- WHY: Leverages server-side optimizations
- EXAMPLE: `src/imap/session.rs:search_emails()`

### Session State Management
- MUST: Track selected folder in `ImapSession` wrapper
- AVOID: Global state or multiple folder selections
- WHY: Maintains consistent session context
- EXAMPLE: `src/imap/session.rs:ImapSession`

Key Business Logic Files:

`src/imap/session.rs`:
```rust
// Core email operations
move_email() - Atomic move with fallback
select_folder() - Folder state management  
search_emails() - Server-side search
store_flags() - Atomic flag updates
```

`src/imap/types.rs`:
```rust
// Domain models
Email - Core email data structure
Folder - IMAP folder representation
SearchCriteria - Search query model
FlagOperation - Flag change operations
```

Business Impact Scores:
- Email Movement (95) - Core data integrity 
- Folder Sync (90) - Critical for consistency
- Search (85) - Key user functionality
- Session State (80) - Important for reliability

$END$
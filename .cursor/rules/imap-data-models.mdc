# imap-data-models

### Core IMAP Data Structures
- MUST: Define all IMAP types in `src/imap/types.rs`
- AVOID: Using raw strings for IMAP identifiers
- WHY: Ensures type safety and protocol compliance
- EXAMPLE: 
```rust
// src/imap/types.rs
pub struct Email {
    uid: Uid,
    flags: Vec<Flag>,
    envelope: Envelope
}
```

### Message Envelope Design
- MUST: Implement envelope parsing in `src/imap/types.rs`
- AVOID: Direct string manipulation of address components
- WHY: IMAP has strict envelope format requirements
- EXAMPLE: `src/imap/types.rs` Envelope struct with Address components

### Mailbox State Management
- MUST: Use OwnedMailbox struct in `src/imap/types.rs` for mailbox state
- AVOID: Storing mutable mailbox state outside OwnedMailbox
- WHY: Maintains IMAP protocol state consistency
- EXAMPLE:
```rust
// src/imap/types.rs
pub struct OwnedMailbox {
    flags: HashSet<String>,
    permanent_flags: HashSet<String>,
    uid_validity: u32
}
```

### Search Criteria Model
- MUST: Implement SearchCriteria enum in `src/imap/types.rs`
- AVOID: Custom search implementations outside SearchCriteria
- WHY: Ensures consistent IMAP search capabilities
- EXAMPLE:
```rust 
// src/imap/types.rs
pub enum SearchCriteria {
    All,
    Unseen,
    Subject(String),
    From(String)
}
```

### Address Formatting
- MUST: Use structured Address type from `src/imap/types.rs`
- AVOID: Manual address string parsing
- WHY: IMAP requires specific address component handling
- EXAMPLE:
```rust
// src/imap/types.rs
pub struct Address {
    name: Option<String>,
    adl: Option<String>,
    mailbox: Option<String>,
    host: Option<String>
}
```

### Folder Hierarchy
- MUST: Use Folder struct in `src/imap/types.rs` for folder representation
- AVOID: Raw path strings for folder operations
- WHY: Maintains IMAP folder attribute consistency
- EXAMPLE:
```rust
// src/imap/types.rs
pub struct Folder {
    name: String,
    delimiter: String,
    attributes: Vec<String>
}
```

### Flag Management
- MUST: Use typed Flag enum in `src/imap/types.rs`
- AVOID: String constants for flags
- WHY: Ensures valid IMAP flag usage
- EXAMPLE: `src/imap/types.rs` Flag implementation

### Testing Requirements
- MUST: Test all type conversions in `src/imap/types_test.rs`
- MUST: Verify envelope parsing with malformed data
- MUST: Test address component validation
- MUST: Verify folder attribute consistency

$END$
# For Mock testing (default)
IMAP_ADAPTER=mock  # No real credentials needed

# Real credentials for specific provider
# IMAP_ADAPTER=godaddy  # or gmail, outlook, etc.
# IMAP_HOST=imap.secureserver.net
# IMAP_PORT=993
# IMAP_USERNAME=real-email@domain.com
# IMAP_PASS=real-password

# Live testing (Requires credentials)
# IMAP_ADAPTER=godaddy cargo test --test e2e_live

# IMAP Operation Timeouts
# Timeout for APPEND operations (saving emails to folders) in seconds
# Default: 35 seconds (handles slow servers with security scanning)
IMAP_APPEND_TIMEOUT_SECONDS=35

# RustyMail REST API Server Configuration
REST_HOST=0.0.0.0
REST_PORT=9437  # Uncommon port for REST API

# RustyMail SSE Server Configuration
SSE_HOST=0.0.0.0
SSE_PORT=9438   # Uncommon port for SSE endpoint

# Dashboard Configuration (if enabled)
DASHBOARD_ENABLED=true
DASHBOARD_PORT=9439  # Uncommon port for dashboard UI
DASHBOARD_PATH=frontend/rustymail-app-main/dist
DASHBOARD_HOST=0.0.0.0

# Logging Configuration
LOG_LEVEL=info

# Security Configuration
# Set to true to require HTTPS
REQUIRE_HTTPS=false

# Credential Encryption Configuration
# Master key for encrypting stored credentials (IMAP/SMTP passwords)
# Must be exactly 64 hex characters (32 bytes)
# Generate a secure key with: openssl rand -hex 32
# SECURITY: Never commit real encryption keys to version control
# If not set, credentials are stored in plaintext (backward compatible)
# ENCRYPTION_MASTER_KEY=your-64-character-hex-key-here

# CORS Configuration
# Comma-separated list of allowed origins for CORS (required for security)
# Example: http://localhost:9439,http://127.0.0.1:9439,https://dashboard.example.com
# Default: http://localhost:9439,http://127.0.0.1:9439 (for development)
ALLOWED_ORIGINS=http://localhost:9439,http://127.0.0.1:9439

# API Authentication
# API key for dashboard and MCP access (REQUIRED)
# Generate a secure key with: openssl rand -hex 32
# SECURITY: Never commit real API keys to version control
RUSTYMAIL_API_KEY=your-secure-api-key-here
VITE_RUSTYMAIL_API_KEY=your-secure-api-key-here

# Frontend API Configuration
VITE_API_URL=/api

# Rate Limiting Configuration
# Limits are per-IP to prevent abuse
RATE_LIMIT_PER_IP_MINUTE=60       # Max requests per IP per minute (default: 60)
RATE_LIMIT_PER_IP_HOUR=1000       # Max requests per IP per hour (default: 1000)
# Whitelist specific IPs to bypass rate limiting (comma-separated)
# RATE_LIMIT_WHITELIST_IPS=127.0.0.1,192.168.1.100

# Connection Pool Configuration
MAX_CONNECTIONS=10
CONNECTION_TIMEOUT=30  # in seconds
POOL_IDLE_TIMEOUT_SECONDS=60          # Time before recycling idle connections
POOL_HEALTH_CHECK_INTERVAL_SECONDS=30 # Interval for connection health checks
POOL_ACQUIRE_TIMEOUT_SECONDS=5        # Timeout when acquiring a connection
POOL_MAX_SESSION_DURATION_SECONDS=300 # Force connection recycling after this time
POOL_MAX_CONCURRENT_CREATIONS=10      # Max concurrent connection creations

# SSE (Server-Sent Events) Configuration
SSE_HEARTBEAT_INTERVAL_SECONDS=5      # Interval between heartbeat messages
SSE_CLIENT_TIMEOUT_SECONDS=10         # Client timeout for SSE connections

# Cache Configuration
CACHE_MAX_MEMORY_ITEMS=200            # Maximum cached items in memory
CACHE_MAX_FOLDER_ITEMS=50             # Maximum cached folders
CACHE_MAX_SIZE_MB=500                 # Maximum cache size in MB
CACHE_MAX_EMAIL_AGE_DAYS=30           # Maximum age for cached emails
CACHE_SYNC_INTERVAL_SECONDS=300       # Interval for cache sync operations

# AI Request Timeout Configuration
AI_REQUEST_TIMEOUT_SECONDS=30         # Default timeout for AI API requests
AI_GENERATION_TIMEOUT_SECONDS=120     # Timeout for longer AI generation requests

# Health Check Thresholds
HEALTH_RESPONSE_TIME_WARNING_MS=1000  # Response time to trigger warning
HEALTH_RESPONSE_TIME_CRITICAL_MS=5000 # Response time to trigger critical alert

# ============================================================================
# Memory Management Configuration
# ============================================================================
# RustyMail uses jemalloc for memory management to properly release memory
# back to the OS after IMAP sessions are closed.
#
# Configure jemalloc to aggressively release memory (optional, defaults are good):
# - dirty_decay_ms: Time before releasing "dirty" (recently freed) pages (default: 10000ms)
# - muzzy_decay_ms: Time before releasing "muzzy" (zero-filled) pages (default: 10000ms)
# - background_thread: Enable background thread for memory maintenance
#
# For aggressive memory release (recommended for memory-constrained environments):
# MALLOC_CONF=background_thread:true,dirty_decay_ms:1000,muzzy_decay_ms:1000
#
# For very aggressive release (may impact performance):
# MALLOC_CONF=background_thread:true,dirty_decay_ms:0,muzzy_decay_ms:0

# ============================================================================
# Database Configuration
# ============================================================================
# RustyMail uses a single SQLite database for email caching and account storage
# Location: ./data/email_cache.db (automatically created on first run)
CACHE_DATABASE_URL=sqlite:data/email_cache.db
#
# This database stores:
# - Cached email messages (for faster loading)
# - Email folders and sync state
# - Account information (synced from config/accounts.json)
#
# Note: Account configuration is stored in config/accounts.json (file-based)
# and synchronized to the database for query performance

# ============================================================================
# AI Service Configuration (for chatbot functionality)
# ============================================================================
# Uncomment and set the appropriate API key and base URL for your chosen provider
# Most providers use OpenAI-compatible APIs with /v1/chat/completions endpoint

# --- OpenAI ---
# OPENAI_API_KEY=sk-...
# OPENAI_BASE_URL=https://api.openai.com/v1
# OPENAI_MODEL=gpt-4o-mini

# --- Anthropic Claude ---
# ANTHROPIC_API_KEY=sk-ant-...
# ANTHROPIC_BASE_URL=https://api.anthropic.com/v1
# ANTHROPIC_MODEL=claude-sonnet-4-5

# --- OpenRouter (Multi-provider gateway) ---
# OPENROUTER_API_KEY=sk-or-...
# OPENROUTER_BASE_URL=https://openrouter.ai/api/v1
# OPENROUTER_MODEL=anthropic/claude-3.5-sonnet

# --- DeepSeek ---
# DEEPSEEK_API_KEY=...
# DEEPSEEK_BASE_URL=https://api.deepseek.com
# DEEPSEEK_MODEL=deepseek-chat

# --- xAI (Grok) ---
# XAI_API_KEY=...
# XAI_BASE_URL=https://api.x.ai/v1
# XAI_MODEL=grok-beta

# --- Google Gemini ---
# GEMINI_API_KEY=...
# GEMINI_BASE_URL=https://generativelanguage.googleapis.com/v1
# GEMINI_MODEL=gemini-2.5-flash

# --- Mistral AI ---
# MISTRAL_API_KEY=...
# MISTRAL_BASE_URL=https://api.mistral.ai/v1
# MISTRAL_MODEL=mistral-large-latest

# --- Together AI ---
# TOGETHER_API_KEY=...
# TOGETHER_BASE_URL=https://api.together.xyz/v1
# TOGETHER_MODEL=meta-llama/Meta-Llama-3.1-8B-Instruct-Turbo

# --- Morpheus (Decentralized AI) ---
# MORPHEUS_API_KEY=...
# MORPHEUS_BASE_URL=https://api.mor.org/api/v1
# MORPHEUS_MODEL=LMR-Hermes-3-Llama-3.1-8B

# --- Azure OpenAI ---
# Azure uses a different URL format: https://{resource-name}.openai.azure.com/openai/deployments/{deployment-id}
# AZURE_OPENAI_API_KEY=...
# AZURE_OPENAI_ENDPOINT=https://your-resource-name.openai.azure.com
# AZURE_OPENAI_DEPLOYMENT=your-deployment-name
# AZURE_OPENAI_API_VERSION=2024-10-01

# --- Ollama (Self-hosted) ---
# Note: Include /v1 suffix for OpenAI-compatible API endpoints
# OLLAMA_BASE_URL=http://localhost:11434/v1
# OLLAMA_MODEL=llama3.2

# ============================================================================
# AI Model Configuration (for High-Level MCP variant) - REQUIRED
# ============================================================================
# AI features require model configuration. Configure via the WebUI Settings
# page or MCP tools BEFORE using AI features. No defaults are provided.
#
# Recommended models for Ollama:
#   Tool-calling (fast, capable): hf.co/unsloth/GLM-4.7-Flash-GGUF:q8_0
#   Drafting (quality content):   gemma3:27b-it-q8_0
#
# Pull these models in Ollama:
#   ollama pull hf.co/unsloth/GLM-4.7-Flash-GGUF:q8_0
#   ollama pull gemma3:27b-it-q8_0

# ============================================================================
# MCP Stdio Proxy Configuration (for Claude Desktop integration)
# ============================================================================
# The thin stdio proxy (rustymail-mcp-stdio) relays JSON-RPC from Claude Desktop
# to the backend MCP server via HTTP
MCP_BACKEND_URL=http://localhost:9437/mcp
MCP_TIMEOUT=30

# ============================================================================
# Agent Executor Configuration
# ============================================================================
# Maximum iterations for the AI agent when processing email instructions
# Set high to handle bulk operations (e.g., processing 10,000 emails)
# Default: 1000
AGENT_MAX_ITERATIONS=1000



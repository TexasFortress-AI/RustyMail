# Task ID: 6
# Title: Complete core IMAP operations implementation
# Status: done
# Dependencies: 4, 5
# Priority: high
# Description: Finish implementation of all IMAP operations: list, search, fetch, move, delete with proper async-imap integration
# Details:
Complete folder listing with hierarchical structure support. Implement server-side search using async-imap search methods. Add message fetching with MIME part handling. Complete move operations with atomic guarantees. Implement delete operations with proper flag handling and expunge.

# Test Strategy:
Create comprehensive integration tests for each operation. Test with multiple IMAP server types (Gmail, Outlook, standard). Verify performance meets requirements (<500ms for folder list, <200ms per email fetch).

# Subtasks:
## 1. Implement hierarchical folder listing [done]
### Dependencies: None
### Description: Develop and integrate folder listing functionality that supports hierarchical structures, correctly handling IMAP hierarchy separators and folder tree traversal.
### Details:
Use async-imap methods to retrieve the full folder tree, detect and apply the correct hierarchy separator, and represent folders in a nested structure. Ensure compatibility with various IMAP servers that may use different separator characters.

## 2. Implement server-side search operations [done]
### Dependencies: 6.1
### Description: Integrate async-imap search methods to enable efficient server-side searching of messages within folders.
### Details:
Support a range of IMAP search criteria (e.g., subject, sender, date). Ensure search queries are executed asynchronously and results are mapped to message identifiers.

## 3. Implement message fetching with MIME part handling [done]
### Dependencies: 6.2
### Description: Develop message fetch functionality that retrieves full messages and parses MIME parts, supporting attachments and multi-part content.
### Details:
Use async-imap fetch methods to retrieve message headers, bodies, and attachments. Parse MIME structure to expose all parts, ensuring correct handling of encodings and nested multiparts.

## 4. Implement atomic move operations [done]
### Dependencies: 6.3
### Description: Enable atomic moving of messages between folders using async-imap, ensuring no message loss or duplication.
### Details:
Use IMAP MOVE command where supported, or fallback to COPY+DELETE with transaction-like guarantees. Handle edge cases such as partial failures and ensure consistency.

## 5. Implement delete operations with flag handling and expunge [done]
### Dependencies: 6.4
### Description: Develop message deletion functionality that sets appropriate IMAP flags and performs expunge to permanently remove messages.
### Details:
Set the \Deleted flag on messages and execute EXPUNGE to remove them. Ensure correct handling of flag updates and server responses.


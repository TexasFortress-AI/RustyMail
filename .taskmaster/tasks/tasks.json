{
  "master": {
    "tasks": [
      {
        "id": 1,
        "title": "Create database migration for AI model configurations",
        "description": "Add ai_model_configurations table to store tool-calling and drafting model settings",
        "details": "Create migrations/004_create_ai_model_config.sql with table schema for role, provider, model_name, base_url, api_key, additional_config. Include default entries for qwen2.5:7b (tool-calling) and llama3.3:70b (drafting)",
        "testStrategy": "",
        "status": "done",
        "dependencies": [],
        "priority": "high",
        "subtasks": []
      },
      {
        "id": 2,
        "title": "Create model configuration service module",
        "description": "Implement model_config.rs for managing AI model configurations in database",
        "details": "Create src/dashboard/services/ai/model_config.rs with ModelConfiguration struct, get_model_config(), set_model_config(), and database CRUD operations. Support both 'tool_calling' and 'drafting' roles.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          1
        ],
        "priority": "high",
        "subtasks": []
      },
      {
        "id": 3,
        "title": "Create high-level tools definitions module",
        "description": "Implement high_level_tools.rs with tool definitions and routing",
        "details": "Create src/dashboard/api/high_level_tools.rs with get_mcp_high_level_tools_jsonrpc_format() returning 10-12 tool definitions: process_email_instructions, draft_reply, draft_email, list_accounts, list_folders_hierarchical, list_cached_emails, get_email_by_uid, search_cached_emails, get_folder_stats, get_model_configurations, set_tool_calling_model, set_drafting_model. Include execute_high_level_tool() router function.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          2
        ],
        "priority": "high",
        "subtasks": []
      },
      {
        "id": 4,
        "title": "Implement model configuration MCP tools",
        "description": "Create handlers for get_model_configurations, set_tool_calling_model, set_drafting_model",
        "details": "Implement the three configuration tools that read/write to ai_model_configurations table. Validate model configurations and test connectivity before saving.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          2,
          3
        ],
        "priority": "high",
        "subtasks": []
      },
      {
        "id": 5,
        "title": "Wire up browsing tools to high-level variant",
        "description": "Connect existing read-only browsing tools to high-level tool router",
        "details": "Reuse existing handlers for list_accounts, list_folders_hierarchical, list_cached_emails, get_email_by_uid, search_cached_emails, get_folder_stats. Add routing logic in execute_high_level_tool() to call these handlers.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          3
        ],
        "priority": "medium",
        "subtasks": []
      },
      {
        "id": 6,
        "title": "Create email drafter service",
        "description": "Implement email_drafter.rs for generating email drafts using configured model",
        "details": "Create src/dashboard/services/ai/email_drafter.rs with EmailDrafter struct, draft_reply() and draft_email() methods. Use model_config to get drafting model settings, call Ollama API to generate text. Include context from original email for replies.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          2
        ],
        "priority": "high",
        "subtasks": []
      },
      {
        "id": 7,
        "title": "Implement draft_reply and draft_email tools",
        "description": "Create MCP tool handlers for email drafting",
        "details": "Implement handlers that fetch email content, construct prompts, call EmailDrafter service, and return formatted draft text. Handle errors gracefully.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          6
        ],
        "priority": "medium",
        "subtasks": []
      },
      {
        "id": 8,
        "title": "Create MCP to Ollama tool converter",
        "description": "Implement tool_converter.rs for converting MCP tool schemas to Ollama format",
        "details": "Create src/dashboard/services/ai/tool_converter.rs with mcp_to_ollama_tools() function. Convert MCP JSON Schema inputSchema to Ollama's tool format. Handle type conversions and required fields.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [],
        "priority": "high",
        "subtasks": []
      },
      {
        "id": 9,
        "title": "Create agent executor with Ollama tool calling",
        "description": "Implement agent_executor.rs for running sub-agent with iterative tool calling",
        "details": "Create src/dashboard/services/ai/agent_executor.rs with AgentExecutor struct and execute_with_tools() method. Implement iterative loop: send instruction with tools to Ollama, handle tool_calls response, execute requested tools using existing handlers, send results back, repeat until completion. Aggregate results and return formatted response with actions_taken list.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          8
        ],
        "priority": "high",
        "subtasks": []
      },
      {
        "id": 10,
        "title": "Implement process_email_instructions tool",
        "description": "Create MCP tool handler for complex email workflow execution",
        "details": "Implement handler that takes natural language instruction, gets tool-calling model config, converts all low-level MCP tools to Ollama format, calls AgentExecutor, formats result. Include logic to detect when user feedback is needed and return questions in JSON format.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          9
        ],
        "priority": "high",
        "subtasks": []
      },
      {
        "id": 11,
        "title": "Add high-level variant support to MCP HTTP backend",
        "description": "Modify mcp_http.rs to support ?variant=high-level query parameter",
        "details": "Update tools/list handler to check for variant parameter and return high-level tools when variant=high-level. Update tools/call handler to route to execute_high_level_tool() for high-level variant. Store variant in session data.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          3,
          10
        ],
        "priority": "high",
        "subtasks": []
      },
      {
        "id": 12,
        "title": "Create high-level MCP stdio binary",
        "description": "Create rustymail-mcp-stdio-high-level binary",
        "details": "Create src/bin/mcp_stdio_high_level.rs that connects to backend with ?variant=high-level parameter. Can be copy of mcp_stdio.rs with modified default URL, or same binary with --mode flag. Add binary to Cargo.toml.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          11
        ],
        "priority": "medium",
        "subtasks": []
      },
      {
        "id": 13,
        "title": "Test high-level MCP variant with Claude Desktop",
        "description": "Integration testing of complete high-level tool flow",
        "status": "pending",
        "dependencies": [
          12
        ],
        "priority": "medium",
        "details": "Configure Claude Desktop to use rustymail-mcp-stdio-high-level binary. Migration 004 (ai_model_configurations table) has been applied with default models: qwen2.5:7b for tool_calling and llama3.3:70b for drafting. Test workflow: 1) Use set_tool_calling_model and set_drafting_model tools to configure actual models instead of defaults, 2) Test browsing tools (list_accounts, list_folders_hierarchical, get_email_by_uid), 3) Test configuration tools (get_model_configurations), 4) Test drafting tools (draft_reply, draft_email), 5) Test process_email_instructions with simple workflows. Verify tool count is ~12 instead of 26+. Process_email_instructions tool should now work properly after database migration fix.",
        "testStrategy": "Configure Claude Desktop with rustymail-mcp-stdio-high-level, verify 12 tools available instead of 26+. First configure models using configuration tools, then test each tool category: browsing (list accounts/folders/emails), drafting (generate replies/emails), and workflow execution (process_email_instructions). Confirm all tools work without database errors.",
        "subtasks": [
          {
            "id": 1,
            "title": "Configure Claude Desktop with high-level MCP binary",
            "description": "Set up Claude Desktop to use rustymail-mcp-stdio-high-level binary and verify connection",
            "dependencies": [],
            "details": "Update Claude Desktop configuration to point to target/release/rustymail-mcp-stdio-high-level binary. Ensure server is running on configured port. Verify Claude Desktop shows ~12 tools available instead of 26+.",
            "status": "pending",
            "testStrategy": "Check Claude Desktop shows correct tool count and can connect to MCP server"
          },
          {
            "id": 2,
            "title": "Configure AI models using configuration tools",
            "description": "Use set_tool_calling_model and set_drafting_model to replace default configurations",
            "dependencies": [
              1
            ],
            "details": "Migration 004 created default configurations (qwen2.5:7b for tool_calling, llama3.3:70b for drafting). Use the MCP configuration tools to set actual models the user wants to use. Test get_model_configurations to verify settings are saved correctly.",
            "status": "pending",
            "testStrategy": "Verify model configurations are saved and retrieved correctly from ai_model_configurations table"
          },
          {
            "id": 3,
            "title": "Test browsing tools functionality",
            "description": "Test list_accounts, list_folders_hierarchical, list_cached_emails, and get_email_by_uid tools",
            "dependencies": [
              2
            ],
            "details": "Verify all browsing tools work correctly with high-level MCP variant. Test that these tools provide the same functionality as the low-level variant but through the simplified interface.",
            "status": "pending",
            "testStrategy": "Execute each browsing tool and verify expected data structure and content returned"
          },
          {
            "id": 4,
            "title": "Test drafting tools functionality",
            "description": "Test draft_reply and draft_email tools using configured drafting model",
            "dependencies": [
              2
            ],
            "details": "Verify AI-powered drafting tools work with the configured drafting model from step 2. Test that drafts are generated with appropriate quality and relevance to input context.",
            "status": "pending",
            "testStrategy": "Generate sample drafts and verify they are contextually appropriate and well-formatted"
          },
          {
            "id": 5,
            "title": "Test process_email_instructions workflow execution",
            "description": "Test the main workflow tool with simple email management instructions",
            "dependencies": [
              2,
              3
            ],
            "details": "Test process_email_instructions with simple workflows like 'list unread emails in INBOX' or 'show folder statistics'. Should now work correctly after ai_model_configurations table migration fix. Verify the tool uses other available tools to complete the workflow.",
            "status": "pending",
            "testStrategy": "Execute simple instructions and verify workflow completion without database errors"
          }
        ]
      },
      {
        "id": 14,
        "title": "Create WebUI settings page for AI model configuration",
        "description": "Add /settings/ai-models page to dashboard",
        "details": "Create UI for configuring tool-calling and drafting models. Include provider dropdown, model name input with autocomplete, base URL input, API key input, test connection button, save button. Display current configurations. Wire up to backend API endpoints.",
        "testStrategy": "",
        "status": "deferred",
        "dependencies": [
          4
        ],
        "priority": "low",
        "subtasks": []
      },
      {
        "id": 15,
        "title": "Document high-level MCP variant in README",
        "description": "Add documentation for new high-level variant",
        "details": "Update README with: explanation of two variants, configuration examples for both, tool list comparison, when to use each variant, model configuration instructions.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          13
        ],
        "priority": "low",
        "subtasks": []
      }
    ],
    "metadata": {
      "version": "1.0.0",
      "lastModified": "2025-10-18T00:12:50.065Z",
      "taskCount": 87,
      "completedCount": 87,
      "tags": [
        "master"
      ],
      "created": "2025-10-18T12:29:46.283Z",
      "description": "Tasks for master context",
      "updated": "2025-10-18T16:24:54.840Z"
    }
  }
}